@function themecolor($s) {
  @return unquote("@" + "#{$s}");
}

@function gtkalpha($c,$a) {
  @return unquote("alpha(#{$c},#{$a})");
}

@mixin colored_header($bg, $backdrop) {
  headerbar,
  searchbar > revealer > box,
  tabbar > revealer > box {
    background-color: $bg;

    &:backdrop {
      background-color: $backdrop;
    }
  }
}

.terminal-window {
  background: transparent;

  &.root {
    @if $variant == 'dark' {
      @include colored_header(#{'shade(@red_5, 0.6)'}, #{'shade(@red_5, 0.52)'});
    }
    @else {
      @include colored_header(#{'shade(@red_1, 1.37)'}, #{'shade(@red_1, 1.45)'});
    }
  }

  &.remote {
    @if $variant == 'dark' {
      @include colored_header(#{'shade(@purple_5, 0.6)'}, #{'shade(@purple_5, 0.52)'});
    }
    @else {
      @include colored_header(#{'shade(@purple_1, 1.27)'}, #{'shade(@purple_1, 1.35)'});
    }
  }

  vte-terminal {
    padding-left: 6px;
    padding-right: 6px;
  }
}

// Taken from nautilus
.floating-bar {
  padding: 6px;
  background-color: themecolor(view_bg_color);
  color: themecolor(view_fg_color);
  box-shadow: 0 0 0 1px themecolor(borders);
  margin-top: 1px;

  &:dir(rtl) {
    border-top-right-radius: 6px;
    margin-right: 1px;
  }

  &:dir(ltr) {
    border-top-left-radius: 6px;
    margin-left: 1px;
  }

  button {
    padding: 0px;
  }
}

.empty-state {
  /* Sync to KgxTerminal! */
  @if $variant == 'light' {
    background: white;
  } @else {
    $bg: rgb(0.05 * 255, 0.05 * 255, 0.05 * 255);

    background: transparentize($bg, 0.04);

    window.opaque & {
      background: $bg;
    }
  }

  color: gtkalpha(currentColor, .5);
}

.exit-info {
  padding: 6px;
  border-top: 2px solid #1e78e4;
  background: rgba(13, 54, 104, 0.96);
  color: #ffffff;

  .error & {
    border-top: 2px solid #ed333b;
    background: rgba(104, 13, 13, 0.96);
  }
}

box.tab:drop(active) {
  outline: 1px solid themecolor(accent_bg_color);
  outline-offset: -1px;

  window:not(.tiled)
        :not(.tiled-top)
        :not(.tiled-bottom)
        :not(.tiled-left)
        :not(.tiled-right)
        :not(.fullscreen)
        :not(.maximized) & {
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
  }
}

.process-list row {
  .header {
    min-height: 0;
  }

  .title {
    font-family: Monospace;
  }
}

.tab-button label {
  font-weight: 800;
  font-size: 8pt;

  &.small {
    font-size: 6pt;
  }
}

@mixin flat_round_button() {
  border-radius: 99px;
  padding: 0;
}

.tab-switcher {
  min-height: 180px;

  list {
    padding-top: 48px;
    padding-bottom: 84px;
    background-color: themecolor(popover_bg_color);
    color: themecolor(popover_fg_color);

    row {
      min-height: 40px;
      padding: 3px;

      &:dir(ltr) { padding-left: 11px; }
      &:dir(rtl) { padding-right: 11px; }

      &.needs-attention {
        color: themecolor(accent_color);
      }

      .close-btn,
      .indicator-btn {
        min-width: 36px;
        min-height: 36px;
        border-radius: 99px;
        padding: 0;
      }
    }
  }

  .collapse-button {
    border-radius: 99px;
    padding: 6px 30px;
    margin: 6px;
  }

  .new-tab-button {
    min-width: 48px;
    min-height: 48px;
    border-radius: 100%;
    padding: 0;
    margin: 18px;
  }
}

themeswitcher {
  $_light_bg: white;
  $_light_fg: transparentize(black, .2);
  $_dark_bg: #1e1e1e;
  $_dark_fg: white;

  padding: 6px;

  .check {
    background: themecolor(accent_bg_color);
    color: white;
    padding: 2px;
    border-radius: 17px;
    margin: 3px;
  }

  /* Adapted from https://gitlab.gnome.org/GNOME/gnome-text-editor/-/blob/bf8c0c249f06a0be69e65aed3b786ba02a9f999e/src/TextEditor.css#L51 */
  checkbutton {
    outline-offset: 1px;
    transition: none;

    radio {
      -gtk-icon-source: none;
      background: none;
      padding: 12px;
      min-height: 24px;
      min-width: 24px;
      border: none;
      outline-color: currentColor;
      transition: none;
      box-shadow: inset 0 0 0 1px themecolor(borders);

      &:checked {
        box-shadow: inset 0 0 0 2px themecolor(accent_bg_color);
      }
    }

    &.system radio {
      @if $variant == 'dark' {
        color: $_dark_fg;
      } else {
        color: $_light_fg;
      }

      background: linear-gradient(-45deg, $_dark_bg 49.99%, $_light_bg 50.01%);
    }

    &.light radio {
      color: $_light_fg;
      background-color: $_light_bg;
    }

    &.dark radio {
      color: $_dark_fg;
      background-color: $_dark_bg;
    }
  }
}
